{% extends "base.html" %}

{% block title %}Delete {{ backend.name }} - Kirin{% endblock %}

{% block breadcrumb %}
<span class="breadcrumb-separator">></span>
<a href="/">Backends</a>
<span class="breadcrumb-separator">></span>
<span>Delete {{ backend.name }}</span>
{% endblock %}

{% block header_title %}Delete Backend{% endblock %}
{% block header_description %}Remove {{ backend.name }} from your configured backends{% endblock %}

{% block content %}
<div class="max-w-2xl mx-auto">
    <!-- Warning Alert -->
    {% if dataset_count > 0 %}
    <div class="alert alert-warning mb-6">
        <strong>⚠️ Warning: This backend has {{ dataset_count }} dataset{{ 's' if dataset_count != 1 else '' }}</strong><br>
        You cannot delete a backend that contains datasets. Please delete all datasets first.
    </div>
    {% endif %}

    <div class="panel">
        <div class="panel-header">
            <h2 class="panel-title">Confirm Deletion</h2>
        </div>
        <div class="panel-content">
            <!-- Backend Details -->
            <div class="space-y-4 mb-6">
                <h3 class="text-lg font-semibold">Backend Details</h3>
                <div class="bg-muted p-4 rounded-lg">
                    <div class="grid grid-cols-2 gap-4">
                        <div>
                            <span class="text-sm text-muted-foreground">Name:</span>
                            <div class="font-medium">{{ backend.name }}</div>
                        </div>
                        <div>
                            <span class="text-sm text-muted-foreground">Type:</span>
                            <div class="font-medium">{{ backend.type.title() }}</div>
                        </div>
                        <div>
                            <span class="text-sm text-muted-foreground">Path:</span>
                            <div class="font-medium">{{ backend.root_dir }}</div>
                        </div>
                        <div>
                            <span class="text-sm text-muted-foreground">Datasets:</span>
                            <div class="font-medium">{{ dataset_count }} dataset{{ 's' if dataset_count != 1 else '' }}</div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Confirmation Message -->
            <div class="space-y-4 mb-6">
                <h3 class="text-lg font-semibold">Are you sure?</h3>
                <p class="text-muted-foreground">
                    This action cannot be undone. The backend configuration will be permanently removed.
                    {% if dataset_count > 0 %}
                    <strong>You must delete all datasets first before deleting this backend.</strong>
                    {% endif %}
                </p>
            </div>

            <!-- Form Actions -->
            <div class="flex gap-3 pt-4">
                <a href="/" class="btn btn-secondary">Cancel</a>
                {% if dataset_count == 0 %}
                <form method="POST" action="/backend/{{ backend.id }}/delete" class="inline">
                    <button type="submit" class="btn btn-destructive" onclick="return confirm('Are you absolutely sure you want to delete this backend? This action cannot be undone.')">
                        <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                            <polyline points="3,6 5,6 21,6"></polyline>
                            <path d="M19,6v14a2,2,0,0,1-2,2H7a2,2,0,0,1-2-2V6m3,0V4a2,2,0,0,1,2-2h4a2,2,0,0,1,2,2V6"></path>
                            <line x1="10" y1="11" x2="10" y2="17"></line>
                            <line x1="14" y1="11" x2="14" y2="17"></line>
                        </svg>
                        Yes, Delete Backend
                    </button>
                </form>
                {% else %}
                <button type="button" class="btn btn-destructive" disabled>
                    <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                        <polyline points="3,6 5,6 21,6"></polyline>
                        <path d="M19,6v14a2,2,0,0,1-2,2H7a2,2,0,0,1-2-2V6m3,0V4a2,2,0,0,1,2-2h4a2,2,0,0,1,2,2V6"></path>
                        <line x1="10" y1="11" x2="10" y2="17"></line>
                        <line x1="14" y1="11" x2="14" y2="17"></line>
                    </svg>
                    Cannot Delete (Has Datasets)
                </button>
                {% endif %}
            </div>
        </div>
    </div>
</div>
{% endblock %}
