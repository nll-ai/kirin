{% extends "base.html" %}

{% block title %}Add Catalog - Kirin{% endblock %}

{% block breadcrumb %}
<span class="breadcrumb-separator">></span>
<span>Add Catalog</span>
{% endblock %}

{% block header_title %}Add Data Catalog{% endblock %}
{% block header_description %}Configure a new data catalog for your datasets{% endblock %}

{% block content %}
<div class="max-w-2xl mx-auto">
    <!-- Error Alert -->
    {% if error %}
    <div class="alert alert-error mb-6">
        <strong>⚠️ {{ error }}</strong>
        {% if existing_catalog_id %}
        <div class="mt-2">
            <a href="/catalog/{{ existing_catalog_id }}" class="btn btn-primary btn-sm">
                Go to Existing Catalog →
            </a>
        </div>
        {% endif %}
    </div>
    {% endif %}

    <div class="panel">
        <div class="panel-header">
            <h2 class="panel-title">Catalog Configuration</h2>
        </div>
        <div class="panel-content">
            <form method="POST" action="/catalogs/add" class="space-y-6">
                <!-- Catalog Name -->
                <div class="form-group">
                    <label for="name" class="form-label required">Catalog Name</label>
                    <input type="text" id="name" name="name" class="input" placeholder="My Data Catalog"
                           value="{{ form_data.name if form_data else '' }}" required>
                    <p class="text-sm text-muted-foreground mt-1">A friendly name for this data catalog</p>
                </div>

                <!-- Root Directory -->
                <div class="form-group">
                    <label for="root_dir" class="form-label required">Root Directory</label>
                    <input type="text" id="root_dir" name="root_dir" class="input"
                           placeholder="/path/to/data or gs://bucket/prefix or s3://bucket/prefix"
                           value="{{ form_data.root_dir if form_data else '' }}" required>
                    <p class="text-sm text-muted-foreground mt-1">
                        Local path or cloud URL (gs://, s3://, az://).
                        <a href="#help" onclick="showHelp()" class="underline">See examples</a>
                    </p>
                </div>

                <!-- Help Section -->
                <div id="help-section" class="hidden">
                    <div class="bg-muted p-4 rounded-lg">
                        <h4 class="font-semibold mb-2">Examples:</h4>
                        <ul class="text-sm space-y-1">
                            <li><strong>Local:</strong> <code>/home/user/data</code></li>
                            <li><strong>Google Cloud:</strong> <code>gs://my-bucket/kirin-data</code></li>
                            <li><strong>Amazon S3:</strong> <code>s3://my-bucket/kirin-data</code></li>
                            <li><strong>Azure:</strong> <code>az://my-container/kirin-data</code></li>
                        </ul>
                        <p class="text-sm mt-2 text-muted-foreground">
                            <strong>Note:</strong> Make sure you're authenticated with your cloud provider
                            (gcloud, aws, az CLI) before using cloud URLs.
                        </p>
                    </div>
                </div>

                <!-- Submit Button -->
                <div class="flex gap-3">
                    <button type="submit" class="btn btn-primary">
                        <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                            <path d="M19 21l-7-5-7 5V5a2 2 0 0 1 2-2h10a2 2 0 0 1 2 2z"></path>
                        </svg>
                        Create Catalog
                    </button>
                    <a href="/" class="btn btn-secondary">
                        Cancel
                    </a>
                </div>
            </form>
        </div>
    </div>
</div>

<script>
function showHelp() {
    const helpSection = document.getElementById('help-section');
    helpSection.classList.toggle('hidden');
}

// Auto-detect storage type from URL
document.getElementById('root_dir').addEventListener('input', function(e) {
    const value = e.target.value;
    const helpSection = document.getElementById('help-section');

    if (value.startsWith('gs://') || value.startsWith('s3://') || value.startsWith('az://')) {
        helpSection.classList.remove('hidden');
    } else if (value.startsWith('/') || value.startsWith('C:\\') || value.startsWith('D:\\')) {
        helpSection.classList.add('hidden');
    }
});
</script>
{% endblock %}
