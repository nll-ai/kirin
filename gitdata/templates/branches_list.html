{% extends "base.html" %}

{% block title %}Branches - {{ dataset_name }}{% endblock %}

{% block content %}
<div class="container">
    <div class="nav-bar">
        <a href="/dataset-view" class="breadcrumb">‚Üê Back to Dataset</a>
        <span class="breadcrumb-separator">/</span>
        <span class="breadcrumb">Branches</span>
    </div>

    <div class="header">
        <h1>Branches</h1>
        <p>Manage branches for dataset: <strong>{{ dataset_name }}</strong></p>
    </div>

    <div class="content-container">
        <!-- Current Branch Info -->
        <div class="panel">
            <div class="panel-header">
                <h2 class="panel-title">Current Branch</h2>
            </div>
            <div class="panel-content">
                <div class="current-branch">
                    <span class="branch-name current">{{ current_branch }}</span>
                    <span class="branch-status">Active</span>
                </div>
            </div>
        </div>

        <!-- Create New Branch -->
        <div class="panel">
            <div class="panel-header">
                <h2 class="panel-title">Create New Branch</h2>
            </div>
            <div class="panel-content">
                <form hx-post="/branches/create" hx-target="#branch-messages" hx-indicator="#create-loading">
                    <div class="form-group">
                        <label class="label" for="branch_name">Branch Name</label>
                        <input
                            type="text"
                            class="input"
                            id="branch_name"
                            name="branch_name"
                            placeholder="e.g., feature/new-feature"
                            required
                        />
                    </div>
                    <button type="submit" class="btn btn-primary">
                        Create Branch
                        <span id="create-loading" class="htmx-indicator spinner"></span>
                    </button>
                </form>
                <div id="branch-messages" class="mt-4"></div>
            </div>
        </div>

        <!-- Branches List -->
        <div class="panel" id="branches-list">
            <div class="panel-header">
                <h2 class="panel-title">All Branches</h2>
            </div>
            <div class="panel-content">
                {% if branches %}
                    <div class="branches-list">
                        {% for branch in branches %}
                        <div class="branch-item {% if branch == current_branch %}current{% endif %}">
                            <div class="branch-info">
                                <span class="branch-name {% if branch == current_branch %}current{% endif %}">
                                    {{ branch }}
                                </span>
                                {% if branch == current_branch %}
                                    <span class="branch-status current">Current</span>
                                {% endif %}
                            </div>
                            <div class="branch-actions">
                                {% if branch != current_branch %}
                                    <form hx-post="/branches/switch" hx-target="#branch-messages" style="display: inline;">
                                        <input type="hidden" name="branch_name" value="{{ branch }}">
                                        <button type="submit" class="btn btn-secondary btn-sm">
                                            Switch
                                        </button>
                                    </form>
                                {% endif %}
                                {% if branch != "main" %}
                                    <form hx-post="/branches/delete" hx-target="#branch-messages" style="display: inline;"
                                          hx-confirm="Are you sure you want to delete branch '{{ branch }}'?">
                                        <input type="hidden" name="branch_name" value="{{ branch }}">
                                        <button type="submit" class="btn btn-destructive btn-sm">
                                            Delete
                                        </button>
                                    </form>
                                {% endif %}
                            </div>
                        </div>
                        {% endfor %}
                    </div>
                {% else %}
                    <div class="empty-state">
                        <p>No branches found. Create your first branch above.</p>
                    </div>
                {% endif %}
            </div>
        </div>
    </div>
</div>

<style>
.current-branch {
    display: flex;
    align-items: center;
    gap: 1rem;
    padding: 1rem;
    background: hsl(var(--muted));
    border-radius: 0.5rem;
}

.branch-name {
    font-weight: 600;
    font-family: 'SF Mono', 'Monaco', 'Inconsolata', 'Roboto Mono', monospace;
}

.branch-name.current {
    color: hsl(var(--primary));
}

.branch-status {
    padding: 0.25rem 0.75rem;
    border-radius: 9999px;
    font-size: 0.875rem;
    font-weight: 500;
    background: hsl(var(--muted));
    color: hsl(var(--muted-foreground));
}

.branch-status.current {
    background: hsl(var(--primary));
    color: hsl(var(--primary-foreground));
}

.branches-list {
    display: flex;
    flex-direction: column;
    gap: 0.5rem;
}

.branch-item {
    display: flex;
    align-items: center;
    justify-content: space-between;
    padding: 1rem;
    border: 1px solid hsl(var(--border));
    border-radius: 0.5rem;
    background: hsl(var(--card));
}

.branch-item.current {
    border-color: hsl(var(--primary));
    background: hsl(var(--primary) / 0.05);
}

.branch-info {
    display: flex;
    align-items: center;
    gap: 1rem;
}

.branch-actions {
    display: flex;
    gap: 0.5rem;
}

.btn-sm {
    padding: 0.5rem 1rem;
    font-size: 0.875rem;
}

.empty-state {
    text-align: center;
    padding: 2rem;
    color: hsl(var(--muted-foreground));
}

.spinner {
    display: inline-block;
    width: 1rem;
    height: 1rem;
    border: 2px solid transparent;
    border-top: 2px solid currentColor;
    border-radius: 50%;
    animation: spin 1s linear infinite;
}

@keyframes spin {
    0% { transform: rotate(0deg); }
    100% { transform: rotate(360deg); }
}

.htmx-indicator {
    opacity: 0;
    transition: opacity 0.2s;
}

.htmx-request .htmx-indicator {
    opacity: 1;
}

.htmx-request.htmx-indicator {
    opacity: 1;
}
</style>
{% endblock %}
